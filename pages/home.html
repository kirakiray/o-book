<template page>
  <l-m src="@pui/button/button.html"></l-m>
  <style>
    :host {
      display: contents;
    }
    .container {
      padding: 20px;
      height: 100%;
      /* background-color: red; */
    }
  </style>
  <div class="container">
    <p>
      这个webapp的所有操作只会在浏览器本地执行，不会上传到服务端。借助这个webapp，你不需要学习和使用什么命令行代码，不需要安装软件到你的系统上，就能生成好看好用的文档静态站。
    </p>
    <p-button on:click="selectDir" attr:disabled="entryLink ? '' : null">
      选择文件夹
    </p-button>
    <x-if :value="entryLink">
      <p>
        <a attr:href="entryLink + 'cn/index.html'" target="_blank">Entry</a>
        <br />
        <a attr:href="entryLink + '_statics/'" target="_blank">Static</a>
        <br />
        <a attr:href="entryLink + 'cn/config.json'" target="_blank">
          Config.json
        </a>
        <br />
        <a attr:href="entryLink + 'cn/_articles.json'" target="_blank">
          articles.json
        </a>
      </p>
    </x-if>
  </div>

  <script>
    export const parent = "./layout.html";

    import { create } from "../src/init-server.js";

    export default async ({ load }) => {
      const { open } = await load("@nos/core/fs/system/main.js");

      return {
        data: {
          entryLink: null,
          mainLang: "cn",
          articleTemp: "", // 正文模板内容
        },
        proto: {
          async selectDir() {
            const handle = await open();

            this._server = await create({
              handle,
              temp: this.articleTemp,
            });

            this.entryLink = this._server.path + "/";
          },
        },
        ready() {
          fetch("/statics/index.html")
            .then((e) => e.text())
            .then((text) => {
              this.articleTemp = text;
            });
        },
      };
    };
  </script>
</template>
