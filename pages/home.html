<template page>
  <l-m src="@pui/button/button.html"></l-m>
  <style>
    .container {
      padding: 20px;
    }
  </style>
  <div class="container">
    I am home
    <br />
    <p-button on:click="selectDir">选择文件夹</p-button>
  </div>

  <script>
    export default async ({ load }) => {
      const { open } = await load("@nos/core/fs/system/main.js");
      const { createApi } = await load("@nos/core/virtual.js");

      return {
        data: {},
        proto: {
          async selectDir() {
            const handle = await open();

            for await (let item of handle.entries()) {
              console.log("sub", item);
            }

            console.log("handle: ", handle);
          },
          async initServer() {
            // const server = createApi({
            //   name: "test",
            //   async callback({
            //     request,
            //     search,
            //     pathname,
            //     searchParams,
            //     hash,
            //   }) {
            //     console.log(request, search, pathname, searchParams, hash);

            //     return {
            //       body: "ok la haha",
            //     };
            //   },
            //   created() {
            //     setTimeout(() => {
            //       window.open(`${server.path}/d?a=aaaaa`);
            //     }, 1000);
            //   },
            // });
          },
        },
        ready() {
          this.initServer();
        },
      };
    };
  </script>
</template>
